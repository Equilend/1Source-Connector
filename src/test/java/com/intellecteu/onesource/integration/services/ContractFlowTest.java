package com.intellecteu.onesource.integration.services;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.SerializationFeature;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import com.intellecteu.onesource.integration.dto.ContractDto;
import com.intellecteu.onesource.integration.dto.record.CloudEventBuildRequest;
import com.intellecteu.onesource.integration.dto.record.IntegrationCloudEvent;
import com.intellecteu.onesource.integration.enums.IntegrationProcess;
import com.intellecteu.onesource.integration.mapper.EventMapper;
import com.intellecteu.onesource.integration.mapper.PositionMapper;
import com.intellecteu.onesource.integration.model.Contract;
import com.intellecteu.onesource.integration.model.EventType;
import com.intellecteu.onesource.integration.model.SettlementUpdate;
import com.intellecteu.onesource.integration.model.spire.Position;
import com.intellecteu.onesource.integration.model.spire.PositionAccount;
import com.intellecteu.onesource.integration.model.spire.PositionExposure;
import com.intellecteu.onesource.integration.repository.AgreementRepository;
import com.intellecteu.onesource.integration.repository.ContractRepository;
import com.intellecteu.onesource.integration.repository.ParticipantHolderRepository;
import com.intellecteu.onesource.integration.repository.PositionRepository;
import com.intellecteu.onesource.integration.repository.SettlementTempRepository;
import com.intellecteu.onesource.integration.repository.SettlementUpdateRepository;
import com.intellecteu.onesource.integration.repository.TimestampRepository;
import com.intellecteu.onesource.integration.repository.TradeEventRepository;
import com.intellecteu.onesource.integration.services.processor.strategy.contract.ContractDataReceived;
import com.intellecteu.onesource.integration.services.record.CloudEventFactory;
import com.intellecteu.onesource.integration.services.record.CloudEventFactoryImpl;
import com.intellecteu.onesource.integration.services.record.CloudEventRecordService;
import com.intellecteu.onesource.integration.services.record.ContractInitiationCloudEventBuilder;
import com.intellecteu.onesource.integration.services.record.ContractSettlementCloudEventBuilder;
import com.intellecteu.onesource.integration.services.record.GenericRecordCloudEventBuilder;
import com.intellecteu.onesource.integration.services.record.IntegrationCloudEventBuilder;
import com.intellecteu.onesource.integration.services.record.MaintainParticipantsCloudEventBuilder;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.test.util.ReflectionTestUtils;
import org.springframework.web.client.RestTemplate;

import java.util.HashMap;
import java.util.List;

import static com.intellecteu.onesource.integration.DtoTestFactory.buildAgreementDto;
import static com.intellecteu.onesource.integration.DtoTestFactory.buildContractDto;
import static com.intellecteu.onesource.integration.DtoTestFactory.buildInstruction;
import static com.intellecteu.onesource.integration.enums.IntegrationProcess.CONTRACT_INITIATION;
import static com.intellecteu.onesource.integration.enums.IntegrationProcess.CONTRACT_SETTLEMENT;
import static com.intellecteu.onesource.integration.enums.IntegrationProcess.GENERIC;
import static com.intellecteu.onesource.integration.enums.IntegrationProcess.MAINTAIN_1SOURCE_PARTICIPANTS_LIST;
import static com.intellecteu.onesource.integration.model.ContractStatus.APPROVED;
import static com.intellecteu.onesource.integration.model.PartyRole.BORROWER;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.eq;
import static org.mockito.Mockito.doNothing;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;
import static org.springframework.http.HttpMethod.PATCH;
import static org.springframework.http.HttpMethod.POST;
import static org.springframework.http.HttpMethod.PUT;

@ExtendWith(MockitoExtension.class)
public class ContractFlowTest {

    private static final String ENDPOINT_FIELD_INJECT = "onesourceBaseEndpoint";
    private static final String LENDER_ENDPOINT_FIELD_INJECT = "lenderSpireEndpoint";
    private static final String BORROWER_ENDPOINT_FIELD_INJECT = "borrowerSpireEndpoint";
    private static final String VERSION_FIELD_INJECT = "version";
    private static final String TEST_ENDPOINT = "http://localhost:8080";
    private static final String TEST_API_VERSION = "/v1";
    private static final String TEST_CONTRACT_ENDPOINT = "/ledger/contracts/{contractId}";
    private static final String TEST_CONTRACT_APPROVE_ENDPOINT = "/ledger/contracts/{contractId}/approve";
    private static final String TEST_CONTRACT_DECLINE_ENDPOINT = "/ledger/contracts/{contractId}/decline";
    private static final String TEST_CONTRACT_CANCEL_ENDPOINT = "/ledger/contracts/{contractId}/cancel";
    private static final String TEST_EDIT_POSITION_ENDPOINT = "/trades/editposition";
    private static final String TEST_UPDATE_INSTRUCTION_ENDPOINT = "/rds/static/instruction/{instructionId}";
    private static final String TEST_GET_INSTRUCTION_ENDPOINT = "/rds/static/instruction";
    private static final String TEST_GET_POSITION_ENDPOINT = "/trades/search/position/query";

    @Mock
    private SettlementUpdateRepository settlementUpdateRepository;

    @Mock
    private SettlementTempRepository settlementTempRepository;
    @Mock
    private PositionRepository positionRepository;

    @Mock
    private ContractRepository contractRepository;
    @Mock
    private TimestampRepository timestampRepository;
    @Mock
    private ParticipantHolderRepository participantHolderRepository;
    @Mock
    private AgreementRepository agreementRepository;

    @Mock
    private RestTemplate restTemplate;

    private EventMapper eventMapper;

    private PositionMapper positionMapper;

    private ObjectMapper objectMapper;
    private OneSourceApiService oneSourceService;
    private SpireApiService spireService;
    private ContractDataReceived contractDataReceived;
    private TradeEventService eventService;
    @Mock
    private CloudEventRecordService cloudEventRecordService;
    @Mock
    private TradeEventRepository eventRepository;
    private CloudEventFactory<IntegrationCloudEvent> recordFactory;

    ContractDto contract;
    Contract contractEntity;
    Position position;

    @BeforeEach
    void setUp() {
        objectMapper = new ObjectMapper();
        objectMapper.registerModule(new JavaTimeModule());
        objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
        eventMapper = new EventMapper();
        positionMapper = new PositionMapper(objectMapper);
        var builderMap = new HashMap<IntegrationProcess, IntegrationCloudEventBuilder>();
        builderMap.put(GENERIC, new GenericRecordCloudEventBuilder());
        builderMap.put(CONTRACT_INITIATION, new ContractInitiationCloudEventBuilder());
        builderMap.put(MAINTAIN_1SOURCE_PARTICIPANTS_LIST, new MaintainParticipantsCloudEventBuilder());
        builderMap.put(CONTRACT_SETTLEMENT, new ContractSettlementCloudEventBuilder());
        recordFactory = new CloudEventFactoryImpl(builderMap);
        oneSourceService = new OneSourceApiService(contractRepository, cloudEventRecordService, restTemplate, settlementUpdateRepository, eventMapper, eventRepository);
        spireService = new SpireApiService(restTemplate, positionRepository, eventMapper, settlementUpdateRepository,
            positionMapper, cloudEventRecordService);
        contractDataReceived = new ContractDataReceived(contractRepository, positionRepository, settlementTempRepository, spireService,
            cloudEventRecordService, eventMapper, positionMapper, agreementRepository, oneSourceService);
        ReflectionTestUtils.setField(spireService, LENDER_ENDPOINT_FIELD_INJECT, TEST_ENDPOINT);
        ReflectionTestUtils.setField(spireService, BORROWER_ENDPOINT_FIELD_INJECT, TEST_ENDPOINT);
        ReflectionTestUtils.setField(oneSourceService, ENDPOINT_FIELD_INJECT, TEST_ENDPOINT);
        ReflectionTestUtils.setField(oneSourceService, VERSION_FIELD_INJECT, TEST_API_VERSION);
        eventService = new TradeEventService(eventRepository, agreementRepository, contractRepository, positionRepository, timestampRepository, participantHolderRepository, eventMapper, spireService, oneSourceService, cloudEventRecordService);
        contract = buildContractDto();
        contractEntity = eventMapper.toContractEntity(contract);
        PositionExposure exposure = new PositionExposure();
        exposure.setCpMarkRoundTo(2);
        position = new Position();
        position.setPositionId("testId");
        position.setExposure(exposure);
        position.setPositionAccount(new PositionAccount("borrower-lei", "test"));
    }

    @Test
    @DisplayName("Contract was successfully approved with 200 response code.")
    void test_contractFlow_shouldApproveContract_success() {
        var agreement = buildAgreementDto();

        SettlementUpdate settlementUpdate = SettlementUpdate.builder()
            .instructionId(2)
            .venueRefId("testVenueRefId")
            .partyRole(BORROWER)
            .instruction(buildInstruction())
            .build();

        var approveContractUrl = TEST_ENDPOINT + TEST_API_VERSION + TEST_CONTRACT_APPROVE_ENDPOINT;
        var contractUrl = TEST_ENDPOINT + TEST_API_VERSION + TEST_CONTRACT_ENDPOINT;
        final ResponseEntity<JsonNode> response = ResponseEntity.status(200).build();

        when(restTemplate.exchange(eq(approveContractUrl), eq(POST), any(), eq(JsonNode.class), eq("testId"))).thenReturn(response);
        when(restTemplate.exchange(eq(contractUrl), eq(PATCH), any(), eq(JsonNode.class), eq("testId"))).thenReturn(response);
        when(positionRepository.findByVenueRefId(any())).thenReturn(List.of(position));
        when(settlementUpdateRepository.findByVenueRefId(any())).thenReturn(List.of(settlementUpdate));
        when(agreementRepository.findByVenueRefId(any())).thenReturn(List.of(eventMapper.toAgreementEntity(agreement)));
        doNothing().when(cloudEventRecordService).record(any());
        when(cloudEventRecordService.getFactory()).thenReturn(recordFactory);

        contractDataReceived.process(contract);

        verify(restTemplate).exchange(eq(approveContractUrl), eq(POST), any(), eq(JsonNode.class), eq("testId"));
        verify(restTemplate).exchange(eq(contractUrl), eq(PATCH), any(), eq(JsonNode.class), eq("testId"));
    }

    @Test
    @DisplayName("Contract proposal successfully declined with 200 response code.")
    void test_contractFlow_shouldDeclineContract_success() {
        var declineContractUrl = TEST_ENDPOINT + TEST_API_VERSION + TEST_CONTRACT_DECLINE_ENDPOINT;
        var approveContractUrl = TEST_ENDPOINT + TEST_API_VERSION + TEST_CONTRACT_APPROVE_ENDPOINT;
        var contractUrl = TEST_ENDPOINT + TEST_API_VERSION + TEST_CONTRACT_ENDPOINT;
        final ResponseEntity<JsonNode> response = ResponseEntity.status(200).build();

        when(restTemplate.exchange(eq(declineContractUrl), eq(POST), any(), eq(JsonNode.class), eq("testId"))).thenReturn(response);
        when(positionRepository.findByVenueRefId(any())).thenReturn(List.of(position));
        when(cloudEventRecordService.getFactory()).thenReturn(recordFactory);
        doNothing().when(cloudEventRecordService).record(any(CloudEventBuildRequest.class));

        contractDataReceived.process(contract);

        verify(restTemplate).exchange(eq(declineContractUrl), eq(POST), any(), eq(JsonNode.class), eq("testId"));
        verify(restTemplate, never()).exchange(eq(approveContractUrl), eq(POST), any(), eq(JsonNode.class), eq("testId"));
        verify(restTemplate, never()).exchange(eq(contractUrl), eq(PATCH), any(), eq(JsonNode.class), eq("testId"));
        verify(cloudEventRecordService, times(2)).record(any(CloudEventBuildRequest.class));
    }

    @Test
    @DisplayName("Position and Instructions were successfully updated.")
    void test_contractFlow_shouldUpdateInstructionsAndPosition_success() throws JsonProcessingException {
        contract.setEventType(EventType.CONTRACT_APPROVE);
        contract.setContractStatus(APPROVED);
        position.setPositionId("2");

        SettlementUpdate settlementUpdate = SettlementUpdate.builder()
            .instructionId(2)
            .venueRefId("testVenueRefId")
            .partyRole(BORROWER)
            .instruction(buildInstruction())
            .build();

        String fullInstructionResponse = """
            {"code":"OK","data":{"beans":[{"__qualifiedName":"string","accountAddress1":"string","accountAddress2":"string","accountAddress3":"string","accountAddress4":"string","accountAddress5":"string","accountDTO":{"__qualifiedName":"string","aba":"string","accountId":0,"accountNo":"string","accountNo2":"string","accountSubTypeId":0,"accountTypeId":0,"allowInvUpload":true,"armsReady":true,"autoborrowCutoffTime":0,"autowrapCutofftime":"string","basisId":0,"biasBmIndexId":0,"biasIgnoreLimit":true,"bicId":0,"billingCurrencyId":0,"callbackMinAmount":0,"callbackTime":"string","callbackType":"string","callinRequired":true,"clientRoundMin":0,"costBasisElection":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"countryId":0,"createTs":"2023-09-11T08:54:09.627Z","createUserId":0,"currencyId":0,"description":"string","donotCallinReturnsUntil":"string","dtc":0,"durations":[{"__qualifiedName":"string","accountId":0,"maxDuration":0,"minDuration":0,"positionTypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"positionTypeId":0}],"endDate":"2023-09-11T08:54:09.627Z","eqlCorpId":0,"eqlLegalId":0,"eqlSubAcctId":"string","excludeFromAutoborrow":true,"extAccountRef":"string","fins":"string","fundAccountNo":"string","inFileArchDir":"string","inFileDir":"string","inFileFormatId":0,"indemnified":true,"industryClassCode":0,"inventoryOption":0,"isAldDisclosed":true,"isBorrowAccount":true,"isErisa":true,"isExclusive":true,"isExternalLender":true,"isLegalEntity":true,"isPooled":true,"isQib":true,"isSubAccount":true,"isTrialBalance":true,"lastModTs":"2023-09-11T08:54:09.627Z","lastModUserId":0,"legalName":"string","lei":"f7195","locatesNotifTime":"string","locatesTemplateId":0,"marginBalance":0,"minAir":0,"mqDefId":0,"name":"string","notInClientRelation":true,"outFileArchDir":"string","outFileDir":"string","outFileFormatId":0,"participating":true,"paymentDate":0,"pdByBusinessDate":true,"poolName":"string","poolPct":0,"profileId":0,"pseudoTaxId":"string","rebateFee":{},"regsLevel":0,"rehypPct":0,"reinvestment":true,"reportLogo":"string","restrictExpireMethod":"string","restrictOnReturn":true,"sameDayQtyOption":0,"shortName":"string","skipGl":true,"startDate":"2023-09-11T08:54:09.627Z","statusId":0,"strategyId":0,"subCustAccountNo":"string","subCustodian":true,"taxId":"string","tradingDeskId":0},"accountId":0,"accountName":"string","accountShortName":"string","agentAddress1":"string","agentAddress2":"string","agentAddress3":"string","agentAddress4":"string","agentAddress5":"string","agentAltCode":"string","agentBicDTO":{"__qualifiedName":"string","bic":"RHBBMYKL","branch":"XXX","devOrProd":"string","institution":"string","swiftBicId":0},"agentBicId":0,"agentName":"string","agentSafe":"string","altCode":"string","bicDTO":{"__qualifiedName":"string","bic":"string","branch":"string","devOrProd":"string","institution":"string","swiftBicId":0},"bicId":0,"categoryDTO":{"__qualifiedName":"string","category0Id":0,"category0Name":"string","category1Id":0,"category1Name":"string","category2Id":0,"category2Name":"string","category3Id":0,"category3Name":"string","category4Id":0,"category4Name":"string","category5Id":0,"category5Name":"string","categoryId":0,"categoryLevel":0,"categoryName":"string","clientCat1Name":"string","defaultDrf":0,"isitClass":"string","monthEndSortTitle":"string","monthEndSortValue":"string","parentId":0,"priceFactor":0,"sortTitle":"string","sortValue":"string"},"categoryId":0,"currencyId":0,"depoId":0,"depositoryDTO":{"__qualifiedName":"string","bulkable":true,"countryId":0,"depoGroup":"string","depoId":0,"depoKy":"string","forAutomark":true,"forPrepayDate":true,"maxQuantity":0,"offset":0,"partyBicBranchRequired":true,"securityRefId":0,"stcoValue":"string","swiftBicId":0,"swiftCode":"string","tzname":"string","useSwiftCodeOnly":true},"instruction":"string","instructionId":0,"parentAccountDTO":{"__qualifiedName":"string","aba":"string","accountId":0,"accountNo":"string","accountNo2":"string","accountSubTypeId":0,"accountTypeId":0,"allowInvUpload":true,"armsReady":true,"autoborrowCutoffTime":0,"autowrapCutofftime":"string","basisId":0,"biasBmIndexId":0,"biasIgnoreLimit":true,"bicId":0,"billingCurrencyId":0,"callbackMinAmount":0,"callbackTime":"string","callbackType":"string","callinRequired":true,"clientRoundMin":0,"costBasisElection":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"countryId":0,"createTs":"2023-09-11T08:54:09.627Z","createUserId":0,"currencyId":0,"description":"string","donotCallinReturnsUntil":"string","dtc":0,"durations":[{"__qualifiedName":"string","accountId":0,"maxDuration":0,"minDuration":0,"positionTypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"positionTypeId":0}],"endDate":"2023-09-11T08:54:09.627Z","eqlCorpId":0,"eqlLegalId":0,"eqlSubAcctId":"string","excludeFromAutoborrow":true,"extAccountRef":"string","fins":"string","fundAccountNo":"string","inFileArchDir":"string","inFileDir":"string","inFileFormatId":0,"indemnified":true,"industryClassCode":0,"inventoryOption":0,"isAldDisclosed":true,"isBorrowAccount":true,"isErisa":true,"isExclusive":true,"isExternalLender":true,"isLegalEntity":true,"isPooled":true,"isQib":true,"isSubAccount":true,"isTrialBalance":true,"lastModTs":"2023-09-11T08:54:09.627Z","lastModUserId":0,"legalName":"string","lei":"string","locatesNotifTime":"string","locatesTemplateId":0,"marginBalance":0,"minAir":0,"mqDefId":0,"name":"string","notInClientRelation":true,"outFileArchDir":"string","outFileDir":"string","outFileFormatId":0,"participating":true,"paymentDate":0,"pdByBusinessDate":true,"poolName":"string","poolPct":0,"profileId":0,"pseudoTaxId":"string","rebateFee":{},"regsLevel":0,"rehypPct":0,"reinvestment":true,"reportLogo":"string","restrictExpireMethod":"string","restrictOnReturn":true,"sameDayQtyOption":0,"shortName":"string","skipGl":true,"startDate":"2023-09-11T08:54:09.627Z","statusId":0,"strategyId":0,"subCustAccountNo":"string","subCustodian":true,"taxId":"string","tradingDeskId":0},"parentAccountId":0,"positionTypeId":0,"positiontypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"safe":"string","securityDetailDTO":{"__qualifiedName":"string","accruedInt":0,"activeAvailableQuantity":0,"activeAvailableValue":0,"activeUtilisation":0,"activeUtilisationByQuantity":0,"advisor":"string","allDayWarr":0,"amountOfIssueOutstanding":0,"asia":"string","autoCloseTime":0,"autoOpenTime":0,"baseFeeRate":0,"baseRateManualUpdate":true,"baseRebateRate":0,"basisId":0,"bloombergId":"string","calendarId":0,"callable":true,"categoryDTO":{"__qualifiedName":"string","category0Id":0,"category0Name":"string","category1Id":0,"category1Name":"string","category2Id":0,"category2Name":"string","category3Id":0,"category3Name":"string","category4Id":0,"category4Name":"string","category5Id":0,"category5Name":"string","categoryId":0,"categoryLevel":0,"categoryName":"string","clientCat1Name":"string","defaultDrf":0,"isitClass":"string","monthEndSortTitle":"string","monthEndSortValue":"string","parentId":0,"priceFactor":0,"sortTitle":"string","sortValue":"string"},"categoryId":0,"categoryName":"string","clientSecId":"string","clientSecId2":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"createTs":"2023-09-11T08:54:09.627Z","createUserId":0,"currencyDTO":{"basisId":0,"bojCurrencyCode":0,"countryId":0,"currencyId":0,"currencyKy":"string","currencyName":"string","currencySymbol":"string"},"cusip":"string","dailyRevenueVwar30":0,"dailyRevenueVwarAll":0,"description":"string","divreqUtilisation":0,"divreqVwarrall":0,"earningDistDay":0,"earningDistSchedule":"string","exchangeId":0,"extendable":true,"fXCurrencyDTO":{"basisId":0,"bojCurrencyCode":0,"countryId":0,"currencyId":0,"currencyKy":"string","currencyName":"string","currencySymbol":"string"},"fXPriceDTO":{"__qualifiedName":"string","askPrice":0,"bidPrice":0,"cleanPrice":0,"comments":"string","defaultPrice":0,"dirtyPrice":0,"id":{"__qualifiedName":"string","currencyId":0,"priceDate":"2023-09-11T08:54:09.627Z","refId":0,"securityId":0},"isDirty":0,"lastModTs":"2023-09-11T08:54:09.627Z","lastModUserId":0,"lastPrice":0,"price":0},"factor":0,"firstAccrualDate":"2023-09-11T08:54:09.627Z","firstCouponIntegerLong":"string","fitch":"string","fitchLt":0,"fitchLtSymbol":"string","fitchLtValue":0,"fitchSt":0,"fitchStSymbol":"string","fitchStValue":0,"fitchWatch":0,"fitchWatchSymbol":"string","fitchWatchValue":0,"frequencyName":"string","fxRate":0,"hotIndex":0,"hotIndexManualUpdate":true,"indexId":0,"industryId":0,"inflationIndex":0,"inflationIndexed":true,"internalBorrowRate":0,"internalLoanRate":0,"is144a":true,"isChilled":"string","isFloating":true,"isLongDuration":true,"isProtectCouponDeflation":true,"isProtectPrincipalDeflation":true,"isRegs":true,"isin":"string","issueDate":"2023-09-11T08:54:09.627Z","issuerId":0,"issuerName":"string","lastAccrualDate":"2023-09-11T08:54:09.628Z","lastModTs":"2023-09-11T08:54:09.628Z","lastModUserId":0,"lendableValue":0,"loanRateAvg":0,"lookBack":0,"marketArea":"string","marketCap":0,"marketPrice":0,"marketVolume":0,"maturityDate":"2023-09-11T08:54:09.628Z","minRebateRate":0,"minTradeableLotIncrement":0,"minTradeableLotSize":0,"mngInternal":0,"mngInternalSymbol":"string","mngInternalValue":0,"moody":"string","moodyLt":0,"moodyLtSymbol":"string","moodyLtValue":0,"moodySt":0,"moodyStSymbol":"string","moodyStValue":0,"moodyWatch":0,"moodyWatchSymbol":"string","moodyWatchValue":0,"newOpportunityCost":0,"nextCorporateActionEventDate":"string","paymentDelay":0,"paymentFrequencyId":0,"price":0,"priceDTO":{"__qualifiedName":"string","askPrice":0,"bidPrice":0,"cleanPrice":0,"comments":"string","defaultPrice":0,"dirtyPrice":0,"id":{"__qualifiedName":"string","currencyId":0,"priceDate":"2023-09-11T08:54:09.628Z","refId":0,"securityId":0},"isDirty":0,"lastModTs":"2023-09-11T08:54:09.628Z","lastModUserId":0,"lastPrice":0,"price":0},"priceFactor":0,"pricingRefId":0,"primaryId":"string","primaryIdType":"string","puttable":true,"quickCode":"string","quickCode2":"string","rate":0,"ratingDate":"2023-09-11T08:54:09.628Z","refAccrualReset":"2023-09-11T08:54:09.628Z","regsLevel":0,"resetFrequencyId":0,"ricId":"string","securityDepoDTO":{"__qualifiedName":"string","id":{"depoId":0,"securityId":0},"isDefault":true},"securityGroupId":0,"securityId":0,"securitychillDTO":{"chillEndDate":"2023-09-11T08:54:09.628Z","chillStartDate":"2023-09-11T08:54:09.628Z","chillTypeId":0,"comments":"string","securityChillConfigId":0,"securityId":0},"sedol":"string","sharesIssued":0,"sharesOutstanding":0,"shortName":"string","sp":"string","spLt":0,"spLtSymbol":"string","spLtValue":0,"spSt":0,"spStSymbol":"string","spStValue":0,"spWatch":0,"spWatchSymbol":"string","spWatchValue":0,"spread":0,"status":"string","statusId":0,"stressHaircut":0,"taxationCountryId":0,"taxationCountryName":"string","ticker":"string","totalBalanceQuantity":0,"totalOnlentQuantity":0,"totalOnlentValue":0,"tradableFee":0,"traderComments":"string","transferAgent":"string","utilization":0,"vehicleClosed":true,"vol10day":0,"vol30day":0,"vol5day":0,"vol90day":0,"vwaf3Day":0,"vwaf7Day":0,"vwafAll":0,"vwar30Day":0,"withholdRate":0},"securityId":0,"tradeTypeId":0}],"groups":[{"avg":{"__qualifiedName":"string","accountAddress1":"string","accountAddress2":"string","accountAddress3":"string","accountAddress4":"string","accountAddress5":"string","accountDTO":{"__qualifiedName":"string","aba":"string","accountId":0,"accountNo":"string","accountNo2":"string","accountSubTypeId":0,"accountTypeId":0,"allowInvUpload":true,"armsReady":true,"autoborrowCutoffTime":0,"autowrapCutofftime":"string","basisId":0,"biasBmIndexId":0,"biasIgnoreLimit":true,"bicId":0,"billingCurrencyId":0,"callbackMinAmount":0,"callbackTime":"string","callbackType":"string","callinRequired":true,"clientRoundMin":0,"costBasisElection":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"countryId":0,"createTs":"2023-09-11T08:54:09.628Z","createUserId":0,"currencyId":0,"description":"string","donotCallinReturnsUntil":"string","dtc":0,"durations":[{"__qualifiedName":"string","accountId":0,"maxDuration":0,"minDuration":0,"positionTypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"positionTypeId":0}],"endDate":"2023-09-11T08:54:09.628Z","eqlCorpId":0,"eqlLegalId":0,"eqlSubAcctId":"string","excludeFromAutoborrow":true,"extAccountRef":"string","fins":"string","fundAccountNo":"string","inFileArchDir":"string","inFileDir":"string","inFileFormatId":0,"indemnified":true,"industryClassCode":0,"inventoryOption":0,"isAldDisclosed":true,"isBorrowAccount":true,"isErisa":true,"isExclusive":true,"isExternalLender":true,"isLegalEntity":true,"isPooled":true,"isQib":true,"isSubAccount":true,"isTrialBalance":true,"lastModTs":"2023-09-11T08:54:09.628Z","lastModUserId":0,"legalName":"string","lei":"string","locatesNotifTime":"string","locatesTemplateId":0,"marginBalance":0,"minAir":0,"mqDefId":0,"name":"string","notInClientRelation":true,"outFileArchDir":"string","outFileDir":"string","outFileFormatId":0,"participating":true,"paymentDate":0,"pdByBusinessDate":true,"poolName":"string","poolPct":0,"profileId":0,"pseudoTaxId":"string","rebateFee":{},"regsLevel":0,"rehypPct":0,"reinvestment":true,"reportLogo":"string","restrictExpireMethod":"string","restrictOnReturn":true,"sameDayQtyOption":0,"shortName":"string","skipGl":true,"startDate":"2023-09-11T08:54:09.628Z","statusId":0,"strategyId":0,"subCustAccountNo":"string","subCustodian":true,"taxId":"string","tradingDeskId":0},"accountId":0,"accountName":"string","accountShortName":"string","agentAddress1":"string","agentAddress2":"string","agentAddress3":"string","agentAddress4":"string","agentAddress5":"string","agentAltCode":"string","agentBicDTO":{"__qualifiedName":"string","bic":"string","branch":"string","devOrProd":"string","institution":"string","swiftBicId":0},"agentBicId":0,"agentName":"string","agentSafe":"string","altCode":"string","bicDTO":{"__qualifiedName":"string","bic":"string","branch":"string","devOrProd":"string","institution":"string","swiftBicId":0},"bicId":0,"categoryDTO":{"__qualifiedName":"string","category0Id":0,"category0Name":"string","category1Id":0,"category1Name":"string","category2Id":0,"category2Name":"string","category3Id":0,"category3Name":"string","category4Id":0,"category4Name":"string","category5Id":0,"category5Name":"string","categoryId":0,"categoryLevel":0,"categoryName":"string","clientCat1Name":"string","defaultDrf":0,"isitClass":"string","monthEndSortTitle":"string","monthEndSortValue":"string","parentId":0,"priceFactor":0,"sortTitle":"string","sortValue":"string"},"categoryId":0,"currencyId":0,"depoId":0,"depositoryDTO":{"__qualifiedName":"string","bulkable":true,"countryId":0,"depoGroup":"string","depoId":0,"depoKy":"string","forAutomark":true,"forPrepayDate":true,"maxQuantity":0,"offset":0,"partyBicBranchRequired":true,"securityRefId":0,"stcoValue":"string","swiftBicId":0,"swiftCode":"string","tzname":"string","useSwiftCodeOnly":true},"instruction":"string","instructionId":0,"parentAccountDTO":{"__qualifiedName":"string","aba":"string","accountId":0,"accountNo":"string","accountNo2":"string","accountSubTypeId":0,"accountTypeId":0,"allowInvUpload":true,"armsReady":true,"autoborrowCutoffTime":0,"autowrapCutofftime":"string","basisId":0,"biasBmIndexId":0,"biasIgnoreLimit":true,"bicId":0,"billingCurrencyId":0,"callbackMinAmount":0,"callbackTime":"string","callbackType":"string","callinRequired":true,"clientRoundMin":0,"costBasisElection":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"countryId":0,"createTs":"2023-09-11T08:54:09.628Z","createUserId":0,"currencyId":0,"description":"string","donotCallinReturnsUntil":"string","dtc":0,"durations":[{"__qualifiedName":"string","accountId":0,"maxDuration":0,"minDuration":0,"positionTypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"positionTypeId":0}],"endDate":"2023-09-11T08:54:09.628Z","eqlCorpId":0,"eqlLegalId":0,"eqlSubAcctId":"string","excludeFromAutoborrow":true,"extAccountRef":"string","fins":"string","fundAccountNo":"string","inFileArchDir":"string","inFileDir":"string","inFileFormatId":0,"indemnified":true,"industryClassCode":0,"inventoryOption":0,"isAldDisclosed":true,"isBorrowAccount":true,"isErisa":true,"isExclusive":true,"isExternalLender":true,"isLegalEntity":true,"isPooled":true,"isQib":true,"isSubAccount":true,"isTrialBalance":true,"lastModTs":"2023-09-11T08:54:09.628Z","lastModUserId":0,"legalName":"string","lei":"string","locatesNotifTime":"string","locatesTemplateId":0,"marginBalance":0,"minAir":0,"mqDefId":0,"name":"string","notInClientRelation":true,"outFileArchDir":"string","outFileDir":"string","outFileFormatId":0,"participating":true,"paymentDate":0,"pdByBusinessDate":true,"poolName":"string","poolPct":0,"profileId":0,"pseudoTaxId":"string","rebateFee":{},"regsLevel":0,"rehypPct":0,"reinvestment":true,"reportLogo":"string","restrictExpireMethod":"string","restrictOnReturn":true,"sameDayQtyOption":0,"shortName":"string","skipGl":true,"startDate":"2023-09-11T08:54:09.628Z","statusId":0,"strategyId":0,"subCustAccountNo":"string","subCustodian":true,"taxId":"string","tradingDeskId":0},"parentAccountId":0,"positionTypeId":0,"positiontypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"safe":"string","securityDetailDTO":{"__qualifiedName":"string","accruedInt":0,"activeAvailableQuantity":0,"activeAvailableValue":0,"activeUtilisation":0,"activeUtilisationByQuantity":0,"advisor":"string","allDayWarr":0,"amountOfIssueOutstanding":0,"asia":"string","autoCloseTime":0,"autoOpenTime":0,"baseFeeRate":0,"baseRateManualUpdate":true,"baseRebateRate":0,"basisId":0,"bloombergId":"string","calendarId":0,"callable":true,"categoryDTO":{"__qualifiedName":"string","category0Id":0,"category0Name":"string","category1Id":0,"category1Name":"string","category2Id":0,"category2Name":"string","category3Id":0,"category3Name":"string","category4Id":0,"category4Name":"string","category5Id":0,"category5Name":"string","categoryId":0,"categoryLevel":0,"categoryName":"string","clientCat1Name":"string","defaultDrf":0,"isitClass":"string","monthEndSortTitle":"string","monthEndSortValue":"string","parentId":0,"priceFactor":0,"sortTitle":"string","sortValue":"string"},"categoryId":0,"categoryName":"string","clientSecId":"string","clientSecId2":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"createTs":"2023-09-11T08:54:09.628Z","createUserId":0,"currencyDTO":{"basisId":0,"bojCurrencyCode":0,"countryId":0,"currencyId":0,"currencyKy":"string","currencyName":"string","currencySymbol":"string"},"cusip":"string","dailyRevenueVwar30":0,"dailyRevenueVwarAll":0,"description":"string","divreqUtilisation":0,"divreqVwarrall":0,"earningDistDay":0,"earningDistSchedule":"string","exchangeId":0,"extendable":true,"fXCurrencyDTO":{"basisId":0,"bojCurrencyCode":0,"countryId":0,"currencyId":0,"currencyKy":"string","currencyName":"string","currencySymbol":"string"},"fXPriceDTO":{"__qualifiedName":"string","askPrice":0,"bidPrice":0,"cleanPrice":0,"comments":"string","defaultPrice":0,"dirtyPrice":0,"id":{"__qualifiedName":"string","currencyId":0,"priceDate":"2023-09-11T08:54:09.628Z","refId":0,"securityId":0},"isDirty":0,"lastModTs":"2023-09-11T08:54:09.628Z","lastModUserId":0,"lastPrice":0,"price":0},"factor":0,"firstAccrualDate":"2023-09-11T08:54:09.628Z","firstCouponIntegerLong":"string","fitch":"string","fitchLt":0,"fitchLtSymbol":"string","fitchLtValue":0,"fitchSt":0,"fitchStSymbol":"string","fitchStValue":0,"fitchWatch":0,"fitchWatchSymbol":"string","fitchWatchValue":0,"frequencyName":"string","fxRate":0,"hotIndex":0,"hotIndexManualUpdate":true,"indexId":0,"industryId":0,"inflationIndex":0,"inflationIndexed":true,"internalBorrowRate":0,"internalLoanRate":0,"is144a":true,"isChilled":"string","isFloating":true,"isLongDuration":true,"isProtectCouponDeflation":true,"isProtectPrincipalDeflation":true,"isRegs":true,"isin":"string","issueDate":"2023-09-11T08:54:09.628Z","issuerId":0,"issuerName":"string","lastAccrualDate":"2023-09-11T08:54:09.628Z","lastModTs":"2023-09-11T08:54:09.628Z","lastModUserId":0,"lendableValue":0,"loanRateAvg":0,"lookBack":0,"marketArea":"string","marketCap":0,"marketPrice":0,"marketVolume":0,"maturityDate":"2023-09-11T08:54:09.628Z","minRebateRate":0,"minTradeableLotIncrement":0,"minTradeableLotSize":0,"mngInternal":0,"mngInternalSymbol":"string","mngInternalValue":0,"moody":"string","moodyLt":0,"moodyLtSymbol":"string","moodyLtValue":0,"moodySt":0,"moodyStSymbol":"string","moodyStValue":0,"moodyWatch":0,"moodyWatchSymbol":"string","moodyWatchValue":0,"newOpportunityCost":0,"nextCorporateActionEventDate":"string","paymentDelay":0,"paymentFrequencyId":0,"price":0,"priceDTO":{"__qualifiedName":"string","askPrice":0,"bidPrice":0,"cleanPrice":0,"comments":"string","defaultPrice":0,"dirtyPrice":0,"id":{"__qualifiedName":"string","currencyId":0,"priceDate":"2023-09-11T08:54:09.629Z","refId":0,"securityId":0},"isDirty":0,"lastModTs":"2023-09-11T08:54:09.629Z","lastModUserId":0,"lastPrice":0,"price":0},"priceFactor":0,"pricingRefId":0,"primaryId":"string","primaryIdType":"string","puttable":true,"quickCode":"string","quickCode2":"string","rate":0,"ratingDate":"2023-09-11T08:54:09.629Z","refAccrualReset":"2023-09-11T08:54:09.629Z","regsLevel":0,"resetFrequencyId":0,"ricId":"string","securityDepoDTO":{"__qualifiedName":"string","id":{"depoId":0,"securityId":0},"isDefault":true},"securityGroupId":0,"securityId":0,"securitychillDTO":{"chillEndDate":"2023-09-11T08:54:09.629Z","chillStartDate":"2023-09-11T08:54:09.629Z","chillTypeId":0,"comments":"string","securityChillConfigId":0,"securityId":0},"sedol":"string","sharesIssued":0,"sharesOutstanding":0,"shortName":"string","sp":"string","spLt":0,"spLtSymbol":"string","spLtValue":0,"spSt":0,"spStSymbol":"string","spStValue":0,"spWatch":0,"spWatchSymbol":"string","spWatchValue":0,"spread":0,"status":"string","statusId":0,"stressHaircut":0,"taxationCountryId":0,"taxationCountryName":"string","ticker":"string","totalBalanceQuantity":0,"totalOnlentQuantity":0,"totalOnlentValue":0,"tradableFee":0,"traderComments":"string","transferAgent":"string","utilization":0,"vehicleClosed":true,"vol10day":0,"vol30day":0,"vol5day":0,"vol90day":0,"vwaf3Day":0,"vwaf7Day":0,"vwafAll":0,"vwar30Day":0,"withholdRate":0},"securityId":0,"tradeTypeId":0},"childrenGroupKeys":["string"],"endIndex":0,"groupLevel":0,"groups":[null],"key":"string","max":{"__qualifiedName":"string","accountAddress1":"string","accountAddress2":"string","accountAddress3":"string","accountAddress4":"string","accountAddress5":"string","accountDTO":{"__qualifiedName":"string","aba":"string","accountId":0,"accountNo":"string","accountNo2":"string","accountSubTypeId":0,"accountTypeId":0,"allowInvUpload":true,"armsReady":true,"autoborrowCutoffTime":0,"autowrapCutofftime":"string","basisId":0,"biasBmIndexId":0,"biasIgnoreLimit":true,"bicId":0,"billingCurrencyId":0,"callbackMinAmount":0,"callbackTime":"string","callbackType":"string","callinRequired":true,"clientRoundMin":0,"costBasisElection":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"countryId":0,"createTs":"2023-09-11T08:54:09.629Z","createUserId":0,"currencyId":0,"description":"string","donotCallinReturnsUntil":"string","dtc":0,"durations":[{"__qualifiedName":"string","accountId":0,"maxDuration":0,"minDuration":0,"positionTypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"positionTypeId":0}],"endDate":"2023-09-11T08:54:09.629Z","eqlCorpId":0,"eqlLegalId":0,"eqlSubAcctId":"string","excludeFromAutoborrow":true,"extAccountRef":"string","fins":"string","fundAccountNo":"string","inFileArchDir":"string","inFileDir":"string","inFileFormatId":0,"indemnified":true,"industryClassCode":0,"inventoryOption":0,"isAldDisclosed":true,"isBorrowAccount":true,"isErisa":true,"isExclusive":true,"isExternalLender":true,"isLegalEntity":true,"isPooled":true,"isQib":true,"isSubAccount":true,"isTrialBalance":true,"lastModTs":"2023-09-11T08:54:09.629Z","lastModUserId":0,"legalName":"string","lei":"string","locatesNotifTime":"string","locatesTemplateId":0,"marginBalance":0,"minAir":0,"mqDefId":0,"name":"string","notInClientRelation":true,"outFileArchDir":"string","outFileDir":"string","outFileFormatId":0,"participating":true,"paymentDate":0,"pdByBusinessDate":true,"poolName":"string","poolPct":0,"profileId":0,"pseudoTaxId":"string","rebateFee":{},"regsLevel":0,"rehypPct":0,"reinvestment":true,"reportLogo":"string","restrictExpireMethod":"string","restrictOnReturn":true,"sameDayQtyOption":0,"shortName":"string","skipGl":true,"startDate":"2023-09-11T08:54:09.629Z","statusId":0,"strategyId":0,"subCustAccountNo":"string","subCustodian":true,"taxId":"string","tradingDeskId":0},"accountId":0,"accountName":"string","accountShortName":"string","agentAddress1":"string","agentAddress2":"string","agentAddress3":"string","agentAddress4":"string","agentAddress5":"string","agentAltCode":"string","agentBicDTO":{"__qualifiedName":"string","bic":"string","branch":"string","devOrProd":"string","institution":"string","swiftBicId":0},"agentBicId":0,"agentName":"string","agentSafe":"string","altCode":"string","bicDTO":{"__qualifiedName":"string","bic":"string","branch":"string","devOrProd":"string","institution":"string","swiftBicId":0},"bicId":0,"categoryDTO":{"__qualifiedName":"string","category0Id":0,"category0Name":"string","category1Id":0,"category1Name":"string","category2Id":0,"category2Name":"string","category3Id":0,"category3Name":"string","category4Id":0,"category4Name":"string","category5Id":0,"category5Name":"string","categoryId":0,"categoryLevel":0,"categoryName":"string","clientCat1Name":"string","defaultDrf":0,"isitClass":"string","monthEndSortTitle":"string","monthEndSortValue":"string","parentId":0,"priceFactor":0,"sortTitle":"string","sortValue":"string"},"categoryId":0,"currencyId":0,"depoId":0,"depositoryDTO":{"__qualifiedName":"string","bulkable":true,"countryId":0,"depoGroup":"string","depoId":0,"depoKy":"string","forAutomark":true,"forPrepayDate":true,"maxQuantity":0,"offset":0,"partyBicBranchRequired":true,"securityRefId":0,"stcoValue":"string","swiftBicId":0,"swiftCode":"string","tzname":"string","useSwiftCodeOnly":true},"instruction":"string","instructionId":0,"parentAccountDTO":{"__qualifiedName":"string","aba":"string","accountId":0,"accountNo":"string","accountNo2":"string","accountSubTypeId":0,"accountTypeId":0,"allowInvUpload":true,"armsReady":true,"autoborrowCutoffTime":0,"autowrapCutofftime":"string","basisId":0,"biasBmIndexId":0,"biasIgnoreLimit":true,"bicId":0,"billingCurrencyId":0,"callbackMinAmount":0,"callbackTime":"string","callbackType":"string","callinRequired":true,"clientRoundMin":0,"costBasisElection":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"countryId":0,"createTs":"2023-09-11T08:54:09.629Z","createUserId":0,"currencyId":0,"description":"string","donotCallinReturnsUntil":"string","dtc":0,"durations":[{"__qualifiedName":"string","accountId":0,"maxDuration":0,"minDuration":0,"positionTypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"positionTypeId":0}],"endDate":"2023-09-11T08:54:09.629Z","eqlCorpId":0,"eqlLegalId":0,"eqlSubAcctId":"string","excludeFromAutoborrow":true,"extAccountRef":"string","fins":"string","fundAccountNo":"string","inFileArchDir":"string","inFileDir":"string","inFileFormatId":0,"indemnified":true,"industryClassCode":0,"inventoryOption":0,"isAldDisclosed":true,"isBorrowAccount":true,"isErisa":true,"isExclusive":true,"isExternalLender":true,"isLegalEntity":true,"isPooled":true,"isQib":true,"isSubAccount":true,"isTrialBalance":true,"lastModTs":"2023-09-11T08:54:09.629Z","lastModUserId":0,"legalName":"string","lei":"string","locatesNotifTime":"string","locatesTemplateId":0,"marginBalance":0,"minAir":0,"mqDefId":0,"name":"string","notInClientRelation":true,"outFileArchDir":"string","outFileDir":"string","outFileFormatId":0,"participating":true,"paymentDate":0,"pdByBusinessDate":true,"poolName":"string","poolPct":0,"profileId":0,"pseudoTaxId":"string","rebateFee":{},"regsLevel":0,"rehypPct":0,"reinvestment":true,"reportLogo":"string","restrictExpireMethod":"string","restrictOnReturn":true,"sameDayQtyOption":0,"shortName":"string","skipGl":true,"startDate":"2023-09-11T08:54:09.629Z","statusId":0,"strategyId":0,"subCustAccountNo":"string","subCustodian":true,"taxId":"string","tradingDeskId":0},"parentAccountId":0,"positionTypeId":0,"positiontypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"safe":"string","securityDetailDTO":{"__qualifiedName":"string","accruedInt":0,"activeAvailableQuantity":0,"activeAvailableValue":0,"activeUtilisation":0,"activeUtilisationByQuantity":0,"advisor":"string","allDayWarr":0,"amountOfIssueOutstanding":0,"asia":"string","autoCloseTime":0,"autoOpenTime":0,"baseFeeRate":0,"baseRateManualUpdate":true,"baseRebateRate":0,"basisId":0,"bloombergId":"string","calendarId":0,"callable":true,"categoryDTO":{"__qualifiedName":"string","category0Id":0,"category0Name":"string","category1Id":0,"category1Name":"string","category2Id":0,"category2Name":"string","category3Id":0,"category3Name":"string","category4Id":0,"category4Name":"string","category5Id":0,"category5Name":"string","categoryId":0,"categoryLevel":0,"categoryName":"string","clientCat1Name":"string","defaultDrf":0,"isitClass":"string","monthEndSortTitle":"string","monthEndSortValue":"string","parentId":0,"priceFactor":0,"sortTitle":"string","sortValue":"string"},"categoryId":0,"categoryName":"string","clientSecId":"string","clientSecId2":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"createTs":"2023-09-11T08:54:09.629Z","createUserId":0,"currencyDTO":{"basisId":0,"bojCurrencyCode":0,"countryId":0,"currencyId":0,"currencyKy":"string","currencyName":"string","currencySymbol":"string"},"cusip":"string","dailyRevenueVwar30":0,"dailyRevenueVwarAll":0,"description":"string","divreqUtilisation":0,"divreqVwarrall":0,"earningDistDay":0,"earningDistSchedule":"string","exchangeId":0,"extendable":true,"fXCurrencyDTO":{"basisId":0,"bojCurrencyCode":0,"countryId":0,"currencyId":0,"currencyKy":"string","currencyName":"string","currencySymbol":"string"},"fXPriceDTO":{"__qualifiedName":"string","askPrice":0,"bidPrice":0,"cleanPrice":0,"comments":"string","defaultPrice":0,"dirtyPrice":0,"id":{"__qualifiedName":"string","currencyId":0,"priceDate":"2023-09-11T08:54:09.629Z","refId":0,"securityId":0},"isDirty":0,"lastModTs":"2023-09-11T08:54:09.629Z","lastModUserId":0,"lastPrice":0,"price":0},"factor":0,"firstAccrualDate":"2023-09-11T08:54:09.629Z","firstCouponIntegerLong":"string","fitch":"string","fitchLt":0,"fitchLtSymbol":"string","fitchLtValue":0,"fitchSt":0,"fitchStSymbol":"string","fitchStValue":0,"fitchWatch":0,"fitchWatchSymbol":"string","fitchWatchValue":0,"frequencyName":"string","fxRate":0,"hotIndex":0,"hotIndexManualUpdate":true,"indexId":0,"industryId":0,"inflationIndex":0,"inflationIndexed":true,"internalBorrowRate":0,"internalLoanRate":0,"is144a":true,"isChilled":"string","isFloating":true,"isLongDuration":true,"isProtectCouponDeflation":true,"isProtectPrincipalDeflation":true,"isRegs":true,"isin":"string","issueDate":"2023-09-11T08:54:09.629Z","issuerId":0,"issuerName":"string","lastAccrualDate":"2023-09-11T08:54:09.629Z","lastModTs":"2023-09-11T08:54:09.629Z","lastModUserId":0,"lendableValue":0,"loanRateAvg":0,"lookBack":0,"marketArea":"string","marketCap":0,"marketPrice":0,"marketVolume":0,"maturityDate":"2023-09-11T08:54:09.629Z","minRebateRate":0,"minTradeableLotIncrement":0,"minTradeableLotSize":0,"mngInternal":0,"mngInternalSymbol":"string","mngInternalValue":0,"moody":"string","moodyLt":0,"moodyLtSymbol":"string","moodyLtValue":0,"moodySt":0,"moodyStSymbol":"string","moodyStValue":0,"moodyWatch":0,"moodyWatchSymbol":"string","moodyWatchValue":0,"newOpportunityCost":0,"nextCorporateActionEventDate":"string","paymentDelay":0,"paymentFrequencyId":0,"price":0,"priceDTO":{"__qualifiedName":"string","askPrice":0,"bidPrice":0,"cleanPrice":0,"comments":"string","defaultPrice":0,"dirtyPrice":0,"id":{"__qualifiedName":"string","currencyId":0,"priceDate":"2023-09-11T08:54:09.629Z","refId":0,"securityId":0},"isDirty":0,"lastModTs":"2023-09-11T08:54:09.629Z","lastModUserId":0,"lastPrice":0,"price":0},"priceFactor":0,"pricingRefId":0,"primaryId":"string","primaryIdType":"string","puttable":true,"quickCode":"string","quickCode2":"string","rate":0,"ratingDate":"2023-09-11T08:54:09.629Z","refAccrualReset":"2023-09-11T08:54:09.629Z","regsLevel":0,"resetFrequencyId":0,"ricId":"string","securityDepoDTO":{"__qualifiedName":"string","id":{"depoId":0,"securityId":0},"isDefault":true},"securityGroupId":0,"securityId":0,"securitychillDTO":{"chillEndDate":"2023-09-11T08:54:09.629Z","chillStartDate":"2023-09-11T08:54:09.629Z","chillTypeId":0,"comments":"string","securityChillConfigId":0,"securityId":0},"sedol":"string","sharesIssued":0,"sharesOutstanding":0,"shortName":"string","sp":"string","spLt":0,"spLtSymbol":"string","spLtValue":0,"spSt":0,"spStSymbol":"string","spStValue":0,"spWatch":0,"spWatchSymbol":"string","spWatchValue":0,"spread":0,"status":"string","statusId":0,"stressHaircut":0,"taxationCountryId":0,"taxationCountryName":"string","ticker":"string","totalBalanceQuantity":0,"totalOnlentQuantity":0,"totalOnlentValue":0,"tradableFee":0,"traderComments":"string","transferAgent":"string","utilization":0,"vehicleClosed":true,"vol10day":0,"vol30day":0,"vol5day":0,"vol90day":0,"vwaf3Day":0,"vwaf7Day":0,"vwafAll":0,"vwar30Day":0,"withholdRate":0},"securityId":0,"tradeTypeId":0},"min":{"__qualifiedName":"string","accountAddress1":"string","accountAddress2":"string","accountAddress3":"string","accountAddress4":"string","accountAddress5":"string","accountDTO":{"__qualifiedName":"string","aba":"string","accountId":0,"accountNo":"string","accountNo2":"string","accountSubTypeId":0,"accountTypeId":0,"allowInvUpload":true,"armsReady":true,"autoborrowCutoffTime":0,"autowrapCutofftime":"string","basisId":0,"biasBmIndexId":0,"biasIgnoreLimit":true,"bicId":0,"billingCurrencyId":0,"callbackMinAmount":0,"callbackTime":"string","callbackType":"string","callinRequired":true,"clientRoundMin":0,"costBasisElection":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"countryId":0,"createTs":"2023-09-11T08:54:09.629Z","createUserId":0,"currencyId":0,"description":"string","donotCallinReturnsUntil":"string","dtc":0,"durations":[{"__qualifiedName":"string","accountId":0,"maxDuration":0,"minDuration":0,"positionTypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"positionTypeId":0}],"endDate":"2023-09-11T08:54:09.629Z","eqlCorpId":0,"eqlLegalId":0,"eqlSubAcctId":"string","excludeFromAutoborrow":true,"extAccountRef":"string","fins":"string","fundAccountNo":"string","inFileArchDir":"string","inFileDir":"string","inFileFormatId":0,"indemnified":true,"industryClassCode":0,"inventoryOption":0,"isAldDisclosed":true,"isBorrowAccount":true,"isErisa":true,"isExclusive":true,"isExternalLender":true,"isLegalEntity":true,"isPooled":true,"isQib":true,"isSubAccount":true,"isTrialBalance":true,"lastModTs":"2023-09-11T08:54:09.629Z","lastModUserId":0,"legalName":"string","lei":"string","locatesNotifTime":"string","locatesTemplateId":0,"marginBalance":0,"minAir":0,"mqDefId":0,"name":"string","notInClientRelation":true,"outFileArchDir":"string","outFileDir":"string","outFileFormatId":0,"participating":true,"paymentDate":0,"pdByBusinessDate":true,"poolName":"string","poolPct":0,"profileId":0,"pseudoTaxId":"string","rebateFee":{},"regsLevel":0,"rehypPct":0,"reinvestment":true,"reportLogo":"string","restrictExpireMethod":"string","restrictOnReturn":true,"sameDayQtyOption":0,"shortName":"string","skipGl":true,"startDate":"2023-09-11T08:54:09.629Z","statusId":0,"strategyId":0,"subCustAccountNo":"string","subCustodian":true,"taxId":"string","tradingDeskId":0},"accountId":0,"accountName":"string","accountShortName":"string","agentAddress1":"string","agentAddress2":"string","agentAddress3":"string","agentAddress4":"string","agentAddress5":"string","agentAltCode":"string","agentBicDTO":{"__qualifiedName":"string","bic":"string","branch":"string","devOrProd":"string","institution":"string","swiftBicId":0},"agentBicId":0,"agentName":"string","agentSafe":"string","altCode":"string","bicDTO":{"__qualifiedName":"string","bic":"string","branch":"string","devOrProd":"string","institution":"string","swiftBicId":0},"bicId":0,"categoryDTO":{"__qualifiedName":"string","category0Id":0,"category0Name":"string","category1Id":0,"category1Name":"string","category2Id":0,"category2Name":"string","category3Id":0,"category3Name":"string","category4Id":0,"category4Name":"string","category5Id":0,"category5Name":"string","categoryId":0,"categoryLevel":0,"categoryName":"string","clientCat1Name":"string","defaultDrf":0,"isitClass":"string","monthEndSortTitle":"string","monthEndSortValue":"string","parentId":0,"priceFactor":0,"sortTitle":"string","sortValue":"string"},"categoryId":0,"currencyId":0,"depoId":0,"depositoryDTO":{"__qualifiedName":"string","bulkable":true,"countryId":0,"depoGroup":"string","depoId":0,"depoKy":"string","forAutomark":true,"forPrepayDate":true,"maxQuantity":0,"offset":0,"partyBicBranchRequired":true,"securityRefId":0,"stcoValue":"string","swiftBicId":0,"swiftCode":"string","tzname":"string","useSwiftCodeOnly":true},"instruction":"string","instructionId":0,"parentAccountDTO":{"__qualifiedName":"string","aba":"string","accountId":0,"accountNo":"string","accountNo2":"string","accountSubTypeId":0,"accountTypeId":0,"allowInvUpload":true,"armsReady":true,"autoborrowCutoffTime":0,"autowrapCutofftime":"string","basisId":0,"biasBmIndexId":0,"biasIgnoreLimit":true,"bicId":0,"billingCurrencyId":0,"callbackMinAmount":0,"callbackTime":"string","callbackType":"string","callinRequired":true,"clientRoundMin":0,"costBasisElection":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"countryId":0,"createTs":"2023-09-11T08:54:09.630Z","createUserId":0,"currencyId":0,"description":"string","donotCallinReturnsUntil":"string","dtc":0,"durations":[{"__qualifiedName":"string","accountId":0,"maxDuration":0,"minDuration":0,"positionTypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"positionTypeId":0}],"endDate":"2023-09-11T08:54:09.630Z","eqlCorpId":0,"eqlLegalId":0,"eqlSubAcctId":"string","excludeFromAutoborrow":true,"extAccountRef":"string","fins":"string","fundAccountNo":"string","inFileArchDir":"string","inFileDir":"string","inFileFormatId":0,"indemnified":true,"industryClassCode":0,"inventoryOption":0,"isAldDisclosed":true,"isBorrowAccount":true,"isErisa":true,"isExclusive":true,"isExternalLender":true,"isLegalEntity":true,"isPooled":true,"isQib":true,"isSubAccount":true,"isTrialBalance":true,"lastModTs":"2023-09-11T08:54:09.630Z","lastModUserId":0,"legalName":"string","lei":"string","locatesNotifTime":"string","locatesTemplateId":0,"marginBalance":0,"minAir":0,"mqDefId":0,"name":"string","notInClientRelation":true,"outFileArchDir":"string","outFileDir":"string","outFileFormatId":0,"participating":true,"paymentDate":0,"pdByBusinessDate":true,"poolName":"string","poolPct":0,"profileId":0,"pseudoTaxId":"string","rebateFee":{},"regsLevel":0,"rehypPct":0,"reinvestment":true,"reportLogo":"string","restrictExpireMethod":"string","restrictOnReturn":true,"sameDayQtyOption":0,"shortName":"string","skipGl":true,"startDate":"2023-09-11T08:54:09.630Z","statusId":0,"strategyId":0,"subCustAccountNo":"string","subCustodian":true,"taxId":"string","tradingDeskId":0},"parentAccountId":0,"positionTypeId":0,"positiontypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"safe":"string","securityDetailDTO":{"__qualifiedName":"string","accruedInt":0,"activeAvailableQuantity":0,"activeAvailableValue":0,"activeUtilisation":0,"activeUtilisationByQuantity":0,"advisor":"string","allDayWarr":0,"amountOfIssueOutstanding":0,"asia":"string","autoCloseTime":0,"autoOpenTime":0,"baseFeeRate":0,"baseRateManualUpdate":true,"baseRebateRate":0,"basisId":0,"bloombergId":"string","calendarId":0,"callable":true,"categoryDTO":{"__qualifiedName":"string","category0Id":0,"category0Name":"string","category1Id":0,"category1Name":"string","category2Id":0,"category2Name":"string","category3Id":0,"category3Name":"string","category4Id":0,"category4Name":"string","category5Id":0,"category5Name":"string","categoryId":0,"categoryLevel":0,"categoryName":"string","clientCat1Name":"string","defaultDrf":0,"isitClass":"string","monthEndSortTitle":"string","monthEndSortValue":"string","parentId":0,"priceFactor":0,"sortTitle":"string","sortValue":"string"},"categoryId":0,"categoryName":"string","clientSecId":"string","clientSecId2":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"createTs":"2023-09-11T08:54:09.630Z","createUserId":0,"currencyDTO":{"basisId":0,"bojCurrencyCode":0,"countryId":0,"currencyId":0,"currencyKy":"string","currencyName":"string","currencySymbol":"string"},"cusip":"string","dailyRevenueVwar30":0,"dailyRevenueVwarAll":0,"description":"string","divreqUtilisation":0,"divreqVwarrall":0,"earningDistDay":0,"earningDistSchedule":"string","exchangeId":0,"extendable":true,"fXCurrencyDTO":{"basisId":0,"bojCurrencyCode":0,"countryId":0,"currencyId":0,"currencyKy":"string","currencyName":"string","currencySymbol":"string"},"fXPriceDTO":{"__qualifiedName":"string","askPrice":0,"bidPrice":0,"cleanPrice":0,"comments":"string","defaultPrice":0,"dirtyPrice":0,"id":{"__qualifiedName":"string","currencyId":0,"priceDate":"2023-09-11T08:54:09.630Z","refId":0,"securityId":0},"isDirty":0,"lastModTs":"2023-09-11T08:54:09.630Z","lastModUserId":0,"lastPrice":0,"price":0},"factor":0,"firstAccrualDate":"2023-09-11T08:54:09.630Z","firstCouponIntegerLong":"string","fitch":"string","fitchLt":0,"fitchLtSymbol":"string","fitchLtValue":0,"fitchSt":0,"fitchStSymbol":"string","fitchStValue":0,"fitchWatch":0,"fitchWatchSymbol":"string","fitchWatchValue":0,"frequencyName":"string","fxRate":0,"hotIndex":0,"hotIndexManualUpdate":true,"indexId":0,"industryId":0,"inflationIndex":0,"inflationIndexed":true,"internalBorrowRate":0,"internalLoanRate":0,"is144a":true,"isChilled":"string","isFloating":true,"isLongDuration":true,"isProtectCouponDeflation":true,"isProtectPrincipalDeflation":true,"isRegs":true,"isin":"string","issueDate":"2023-09-11T08:54:09.630Z","issuerId":0,"issuerName":"string","lastAccrualDate":"2023-09-11T08:54:09.630Z","lastModTs":"2023-09-11T08:54:09.630Z","lastModUserId":0,"lendableValue":0,"loanRateAvg":0,"lookBack":0,"marketArea":"string","marketCap":0,"marketPrice":0,"marketVolume":0,"maturityDate":"2023-09-11T08:54:09.630Z","minRebateRate":0,"minTradeableLotIncrement":0,"minTradeableLotSize":0,"mngInternal":0,"mngInternalSymbol":"string","mngInternalValue":0,"moody":"string","moodyLt":0,"moodyLtSymbol":"string","moodyLtValue":0,"moodySt":0,"moodyStSymbol":"string","moodyStValue":0,"moodyWatch":0,"moodyWatchSymbol":"string","moodyWatchValue":0,"newOpportunityCost":0,"nextCorporateActionEventDate":"string","paymentDelay":0,"paymentFrequencyId":0,"price":0,"priceDTO":{"__qualifiedName":"string","askPrice":0,"bidPrice":0,"cleanPrice":0,"comments":"string","defaultPrice":0,"dirtyPrice":0,"id":{"__qualifiedName":"string","currencyId":0,"priceDate":"2023-09-11T08:54:09.630Z","refId":0,"securityId":0},"isDirty":0,"lastModTs":"2023-09-11T08:54:09.630Z","lastModUserId":0,"lastPrice":0,"price":0},"priceFactor":0,"pricingRefId":0,"primaryId":"string","primaryIdType":"string","puttable":true,"quickCode":"string","quickCode2":"string","rate":0,"ratingDate":"2023-09-11T08:54:09.630Z","refAccrualReset":"2023-09-11T08:54:09.630Z","regsLevel":0,"resetFrequencyId":0,"ricId":"string","securityDepoDTO":{"__qualifiedName":"string","id":{"depoId":0,"securityId":0},"isDefault":true},"securityGroupId":0,"securityId":0,"securitychillDTO":{"chillEndDate":"2023-09-11T08:54:09.630Z","chillStartDate":"2023-09-11T08:54:09.630Z","chillTypeId":0,"comments":"string","securityChillConfigId":0,"securityId":0},"sedol":"string","sharesIssued":0,"sharesOutstanding":0,"shortName":"string","sp":"string","spLt":0,"spLtSymbol":"string","spLtValue":0,"spSt":0,"spStSymbol":"string","spStValue":0,"spWatch":0,"spWatchSymbol":"string","spWatchValue":0,"spread":0,"status":"string","statusId":0,"stressHaircut":0,"taxationCountryId":0,"taxationCountryName":"string","ticker":"string","totalBalanceQuantity":0,"totalOnlentQuantity":0,"totalOnlentValue":0,"tradableFee":0,"traderComments":"string","transferAgent":"string","utilization":0,"vehicleClosed":true,"vol10day":0,"vol30day":0,"vol5day":0,"vol90day":0,"vwaf3Day":0,"vwaf7Day":0,"vwafAll":0,"vwar30Day":0,"withholdRate":0},"securityId":0,"tradeTypeId":0},"startIndex":0,"sum":{"__qualifiedName":"string","accountAddress1":"string","accountAddress2":"string","accountAddress3":"string","accountAddress4":"string","accountAddress5":"string","accountDTO":{"__qualifiedName":"string","aba":"string","accountId":0,"accountNo":"string","accountNo2":"string","accountSubTypeId":0,"accountTypeId":0,"allowInvUpload":true,"armsReady":true,"autoborrowCutoffTime":0,"autowrapCutofftime":"string","basisId":0,"biasBmIndexId":0,"biasIgnoreLimit":true,"bicId":0,"billingCurrencyId":0,"callbackMinAmount":0,"callbackTime":"string","callbackType":"string","callinRequired":true,"clientRoundMin":0,"costBasisElection":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"countryId":0,"createTs":"2023-09-11T08:54:09.630Z","createUserId":0,"currencyId":0,"description":"string","donotCallinReturnsUntil":"string","dtc":0,"durations":[{"__qualifiedName":"string","accountId":0,"maxDuration":0,"minDuration":0,"positionTypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"positionTypeId":0}],"endDate":"2023-09-11T08:54:09.630Z","eqlCorpId":0,"eqlLegalId":0,"eqlSubAcctId":"string","excludeFromAutoborrow":true,"extAccountRef":"string","fins":"string","fundAccountNo":"string","inFileArchDir":"string","inFileDir":"string","inFileFormatId":0,"indemnified":true,"industryClassCode":0,"inventoryOption":0,"isAldDisclosed":true,"isBorrowAccount":true,"isErisa":true,"isExclusive":true,"isExternalLender":true,"isLegalEntity":true,"isPooled":true,"isQib":true,"isSubAccount":true,"isTrialBalance":true,"lastModTs":"2023-09-11T08:54:09.630Z","lastModUserId":0,"legalName":"string","lei":"string","locatesNotifTime":"string","locatesTemplateId":0,"marginBalance":0,"minAir":0,"mqDefId":0,"name":"string","notInClientRelation":true,"outFileArchDir":"string","outFileDir":"string","outFileFormatId":0,"participating":true,"paymentDate":0,"pdByBusinessDate":true,"poolName":"string","poolPct":0,"profileId":0,"pseudoTaxId":"string","rebateFee":{},"regsLevel":0,"rehypPct":0,"reinvestment":true,"reportLogo":"string","restrictExpireMethod":"string","restrictOnReturn":true,"sameDayQtyOption":0,"shortName":"string","skipGl":true,"startDate":"2023-09-11T08:54:09.630Z","statusId":0,"strategyId":0,"subCustAccountNo":"string","subCustodian":true,"taxId":"string","tradingDeskId":0},"accountId":0,"accountName":"string","accountShortName":"string","agentAddress1":"string","agentAddress2":"string","agentAddress3":"string","agentAddress4":"string","agentAddress5":"string","agentAltCode":"string","agentBicDTO":{"__qualifiedName":"string","bic":"string","branch":"string","devOrProd":"string","institution":"string","swiftBicId":0},"agentBicId":0,"agentName":"string","agentSafe":"string","altCode":"string","bicDTO":{"__qualifiedName":"string","bic":"string","branch":"string","devOrProd":"string","institution":"string","swiftBicId":0},"bicId":0,"categoryDTO":{"__qualifiedName":"string","category0Id":0,"category0Name":"string","category1Id":0,"category1Name":"string","category2Id":0,"category2Name":"string","category3Id":0,"category3Name":"string","category4Id":0,"category4Name":"string","category5Id":0,"category5Name":"string","categoryId":0,"categoryLevel":0,"categoryName":"string","clientCat1Name":"string","defaultDrf":0,"isitClass":"string","monthEndSortTitle":"string","monthEndSortValue":"string","parentId":0,"priceFactor":0,"sortTitle":"string","sortValue":"string"},"categoryId":0,"currencyId":0,"depoId":0,"depositoryDTO":{"__qualifiedName":"string","bulkable":true,"countryId":0,"depoGroup":"string","depoId":0,"depoKy":"string","forAutomark":true,"forPrepayDate":true,"maxQuantity":0,"offset":0,"partyBicBranchRequired":true,"securityRefId":0,"stcoValue":"string","swiftBicId":0,"swiftCode":"string","tzname":"string","useSwiftCodeOnly":true},"instruction":"string","instructionId":12345,"parentAccountDTO":{"__qualifiedName":"string","aba":"string","accountId":0,"accountNo":"string","accountNo2":"string","accountSubTypeId":0,"accountTypeId":0,"allowInvUpload":true,"armsReady":true,"autoborrowCutoffTime":0,"autowrapCutofftime":"string","basisId":0,"biasBmIndexId":0,"biasIgnoreLimit":true,"bicId":0,"billingCurrencyId":0,"callbackMinAmount":0,"callbackTime":"string","callbackType":"string","callinRequired":true,"clientRoundMin":0,"costBasisElection":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"countryId":0,"createTs":"2023-09-11T08:54:09.630Z","createUserId":0,"currencyId":0,"description":"string","donotCallinReturnsUntil":"string","dtc":0,"durations":[{"__qualifiedName":"string","accountId":0,"maxDuration":0,"minDuration":0,"positionTypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"positionTypeId":0}],"endDate":"2023-09-11T08:54:09.630Z","eqlCorpId":0,"eqlLegalId":0,"eqlSubAcctId":"string","excludeFromAutoborrow":true,"extAccountRef":"string","fins":"string","fundAccountNo":"string","inFileArchDir":"string","inFileDir":"string","inFileFormatId":0,"indemnified":true,"industryClassCode":0,"inventoryOption":0,"isAldDisclosed":true,"isBorrowAccount":true,"isErisa":true,"isExclusive":true,"isExternalLender":true,"isLegalEntity":true,"isPooled":true,"isQib":true,"isSubAccount":true,"isTrialBalance":true,"lastModTs":"2023-09-11T08:54:09.630Z","lastModUserId":0,"legalName":"string","lei":"string","locatesNotifTime":"string","locatesTemplateId":0,"marginBalance":0,"minAir":0,"mqDefId":0,"name":"string","notInClientRelation":true,"outFileArchDir":"string","outFileDir":"string","outFileFormatId":0,"participating":true,"paymentDate":0,"pdByBusinessDate":true,"poolName":"string","poolPct":0,"profileId":0,"pseudoTaxId":"string","rebateFee":{},"regsLevel":0,"rehypPct":0,"reinvestment":true,"reportLogo":"string","restrictExpireMethod":"string","restrictOnReturn":true,"sameDayQtyOption":0,"shortName":"string","skipGl":true,"startDate":"2023-09-11T08:54:09.630Z","statusId":0,"strategyId":0,"subCustAccountNo":"string","subCustodian":true,"taxId":"string","tradingDeskId":0},"parentAccountId":0,"positionTypeId":0,"positiontypeDTO":{"accrualTypeId":0,"canBePooled":true,"collateralIndicator":true,"drCrIndicator":true,"exposureIndicator":true,"flatAccrual":true,"forTradeEntry":true,"futureLimitDays":0,"isCash":true,"ledgerAccountId":0,"minRate":0,"negSettleTradeTypeId":0,"parentId":0,"positionType":"string","positionTypeId":0,"settleTradeTypeId":0},"safe":"string","securityDetailDTO":{"__qualifiedName":"string","accruedInt":0,"activeAvailableQuantity":0,"activeAvailableValue":0,"activeUtilisation":0,"activeUtilisationByQuantity":0,"advisor":"string","allDayWarr":0,"amountOfIssueOutstanding":0,"asia":"string","autoCloseTime":0,"autoOpenTime":0,"baseFeeRate":0,"baseRateManualUpdate":true,"baseRebateRate":0,"basisId":0,"bloombergId":"string","calendarId":0,"callable":true,"categoryDTO":{"__qualifiedName":"string","category0Id":0,"category0Name":"string","category1Id":0,"category1Name":"string","category2Id":0,"category2Name":"string","category3Id":0,"category3Name":"string","category4Id":0,"category4Name":"string","category5Id":0,"category5Name":"string","categoryId":0,"categoryLevel":0,"categoryName":"string","clientCat1Name":"string","defaultDrf":0,"isitClass":"string","monthEndSortTitle":"string","monthEndSortValue":"string","parentId":0,"priceFactor":0,"sortTitle":"string","sortValue":"string"},"categoryId":0,"categoryName":"string","clientSecId":"string","clientSecId2":"string","countryDTO":{"__qualifiedName":"string","aldRegion":"string","bojCountryCode":0,"calendarId":0,"countryId":0,"countryKy":"string","countryName":"string","extCountryCode":"string","region":"string"},"createTs":"2023-09-11T08:54:09.630Z","createUserId":0,"currencyDTO":{"basisId":0,"bojCurrencyCode":0,"countryId":0,"currencyId":0,"currencyKy":"string","currencyName":"string","currencySymbol":"string"},"cusip":"string","dailyRevenueVwar30":0,"dailyRevenueVwarAll":0,"description":"string","divreqUtilisation":0,"divreqVwarrall":0,"earningDistDay":0,"earningDistSchedule":"string","exchangeId":0,"extendable":true,"fXCurrencyDTO":{"basisId":0,"bojCurrencyCode":0,"countryId":0,"currencyId":0,"currencyKy":"string","currencyName":"string","currencySymbol":"string"},"fXPriceDTO":{"__qualifiedName":"string","askPrice":0,"bidPrice":0,"cleanPrice":0,"comments":"string","defaultPrice":0,"dirtyPrice":0,"id":{"__qualifiedName":"string","currencyId":0,"priceDate":"2023-09-11T08:54:09.630Z","refId":0,"securityId":0},"isDirty":0,"lastModTs":"2023-09-11T08:54:09.630Z","lastModUserId":0,"lastPrice":0,"price":0},"factor":0,"firstAccrualDate":"2023-09-11T08:54:09.630Z","firstCouponIntegerLong":"string","fitch":"string","fitchLt":0,"fitchLtSymbol":"string","fitchLtValue":0,"fitchSt":0,"fitchStSymbol":"string","fitchStValue":0,"fitchWatch":0,"fitchWatchSymbol":"string","fitchWatchValue":0,"frequencyName":"string","fxRate":0,"hotIndex":0,"hotIndexManualUpdate":true,"indexId":0,"industryId":0,"inflationIndex":0,"inflationIndexed":true,"internalBorrowRate":0,"internalLoanRate":0,"is144a":true,"isChilled":"string","isFloating":true,"isLongDuration":true,"isProtectCouponDeflation":true,"isProtectPrincipalDeflation":true,"isRegs":true,"isin":"string","issueDate":"2023-09-11T08:54:09.630Z","issuerId":0,"issuerName":"string","lastAccrualDate":"2023-09-11T08:54:09.630Z","lastModTs":"2023-09-11T08:54:09.630Z","lastModUserId":0,"lendableValue":0,"loanRateAvg":0,"lookBack":0,"marketArea":"string","marketCap":0,"marketPrice":0,"marketVolume":0,"maturityDate":"2023-09-11T08:54:09.630Z","minRebateRate":0,"minTradeableLotIncrement":0,"minTradeableLotSize":0,"mngInternal":0,"mngInternalSymbol":"string","mngInternalValue":0,"moody":"string","moodyLt":0,"moodyLtSymbol":"string","moodyLtValue":0,"moodySt":0,"moodyStSymbol":"string","moodyStValue":0,"moodyWatch":0,"moodyWatchSymbol":"string","moodyWatchValue":0,"newOpportunityCost":0,"nextCorporateActionEventDate":"string","paymentDelay":0,"paymentFrequencyId":0,"price":0,"priceDTO":{"__qualifiedName":"string","askPrice":0,"bidPrice":0,"cleanPrice":0,"comments":"string","defaultPrice":0,"dirtyPrice":0,"id":{"__qualifiedName":"string","currencyId":0,"priceDate":"2023-09-11T08:54:09.630Z","refId":0,"securityId":0},"isDirty":0,"lastModTs":"2023-09-11T08:54:09.630Z","lastModUserId":0,"lastPrice":0,"price":0},"priceFactor":0,"pricingRefId":0,"primaryId":"string","primaryIdType":"string","puttable":true,"quickCode":"string","quickCode2":"string","rate":0,"ratingDate":"2023-09-11T08:54:09.630Z","refAccrualReset":"2023-09-11T08:54:09.630Z","regsLevel":0,"resetFrequencyId":0,"ricId":"string","securityDepoDTO":{"__qualifiedName":"string","id":{"depoId":0,"securityId":0},"isDefault":true},"securityGroupId":0,"securityId":0,"securitychillDTO":{"chillEndDate":"2023-09-11T08:54:09.630Z","chillStartDate":"2023-09-11T08:54:09.630Z","chillTypeId":0,"comments":"string","securityChillConfigId":0,"securityId":0},"sedol":"string","sharesIssued":0,"sharesOutstanding":0,"shortName":"string","sp":"string","spLt":0,"spLtSymbol":"string","spLtValue":0,"spSt":0,"spStSymbol":"string","spStValue":0,"spWatch":0,"spWatchSymbol":"string","spWatchValue":0,"spread":0,"status":"string","statusId":0,"stressHaircut":0,"taxationCountryId":0,"taxationCountryName":"string","ticker":"string","totalBalanceQuantity":0,"totalOnlentQuantity":0,"totalOnlentValue":0,"tradableFee":0,"traderComments":"string","transferAgent":"string","utilization":0,"vehicleClosed":true,"vol10day":0,"vol30day":0,"vol5day":0,"vol90day":0,"vwaf3Day":0,"vwaf7Day":0,"vwafAll":0,"vwar30Day":0,"withholdRate":0},"securityId":0,"tradeTypeId":0},"value":{}}],"totalRows":2},"errCode":"string","error":true,"message":"string","status":"OK","success":true}
            """;

        JsonNode instructionNode = objectMapper.readTree(fullInstructionResponse);
        final ResponseEntity<JsonNode> instructionResponse = new ResponseEntity<>(instructionNode, HttpStatus.OK);

        var editPositionUrl = TEST_ENDPOINT + TEST_EDIT_POSITION_ENDPOINT;
        var updateInstructionsUrl = TEST_ENDPOINT + TEST_UPDATE_INSTRUCTION_ENDPOINT;
        var getInstructionUrl = TEST_ENDPOINT + TEST_GET_INSTRUCTION_ENDPOINT;
        final ResponseEntity<JsonNode> response = ResponseEntity.status(200).build();

        when(restTemplate.postForEntity(eq(editPositionUrl), any(), eq(JsonNode.class))).thenReturn(response);
        when(restTemplate.exchange(eq(updateInstructionsUrl), eq(PUT), any(), eq(JsonNode.class), eq(2))).thenReturn(response);
        when(restTemplate.postForEntity(eq(getInstructionUrl), any(), eq(JsonNode.class))).thenReturn(
            instructionResponse);
        when(positionRepository.findByVenueRefId(any())).thenReturn(List.of(position));
        when(settlementUpdateRepository.findByVenueRefId(any())).thenReturn(List.of(settlementUpdate));
        doNothing().when(cloudEventRecordService).record(any());
        when(cloudEventRecordService.getFactory()).thenReturn(recordFactory);

        contractDataReceived.process(contract);

        verify(restTemplate).postForEntity(eq(editPositionUrl), any(), eq(JsonNode.class));
        verify(restTemplate).postForEntity(eq(getInstructionUrl), any(), eq(JsonNode.class));
        verify(restTemplate).exchange(eq(updateInstructionsUrl), eq(PUT), any(), eq(JsonNode.class), eq(2));
    }

    @Test
    @DisplayName("Contract proposal successfully canceled")
    void test_contractFlow_shouldCancelContract_success() throws JsonProcessingException {
        String fullPositionResponse = """
            {"data":{"beans":[{"id":1,"positionId":"testSpirePositionId","customValue2":"testVenueRefId","rate":10.2,"quantity":2.0,"tradeDate":"2023-11-14T16:52:06.060844","settleDate":"2023-11-14T16:52:06.061189","deliverFree":false,"amount":400.32,"price":100.0,"contractValue":4.52,"positionTypeId":null,"currencyId":null,"securityId":null,"accountLei":"lender-lei","cpLei":"borrower-lei","collateralType":"CASH","cpHaircut":2.02,"cpMarkRoundTo":2,"depoId":null,"securityDetailDTO":{"ticker":"testTicker","cusip":"testCusip","isin":"testIsin","sedol":"testSedol","quickCode":"testQuick","bloombergId":"testFigi"},"currencyDTO":{"currencyName":"EUR"},"loanBorrowDTO":{"taxWithholdingRate":2.0},"collateralTypeDTO":{"collateralType":"CASH"},"exposureDTO":{"cpHaircut":2.02,"cpMarkRoundTo":2,"depoId":null},"positiontypeDTO":{"positionType":"CASH LOAN"},"statusDTO":{"status":"CANCELED"},"accountDTO":{"dtc":null,"lei":"lender-lei"},"counterPartyDTO":{"dtc":null,"lei":"borrower-lei"}}],"totalRows":1},"status":"SUCCESS","code":"SUCCESS","success":true,"error":false}
            """;

        String positionEntityResponse = """
            {"id":1,"positionId":"testSpirePositionId","customValue2":"testVenueRefId","rate":10.2,"quantity":2.0,"tradeDate":"2023-11-14T16:52:06.060844","settleDate":"2023-11-14T16:52:06.061189","deliverFree":false,"amount":400.32,"price":100.0,"contractValue":4.52,"positionTypeId":null,"currencyId":null,"securityId":null,"accountLei":"lender-lei","cpLei":"borrower-lei","collateralType":"CASH","cpHaircut":2.02,"cpMarkRoundTo":2,"depoId":null,"securityDetailDTO":{"ticker":"testTicker","cusip":"testCusip","isin":"testIsin","sedol":"testSedol","quickCode":"testQuick","bloombergId":"testFigi"},"currencyDTO":{"currencyName":"EUR"},"loanBorrowDTO":{"taxWithholdingRate":2.0},"collateralTypeDTO":{"collateralType":"CASH"},"exposureDTO":{"cpHaircut":2.02,"cpMarkRoundTo":2,"depoId":null},"positiontypeDTO":{"positionType":"CASH LOAN"},"accountDTO":{"dtc":null,"lei":"lender-lei"},"counterPartyDTO":{"dtc":null,"lei":"borrower-lei"}}
            """;

        var getPositionUrl = TEST_ENDPOINT + TEST_GET_POSITION_ENDPOINT;
        JsonNode node = objectMapper.readTree(fullPositionResponse);
        JsonNode positionEntityNode = objectMapper.readTree(positionEntityResponse);
        var positionEntity = positionMapper.toPosition(positionEntityNode);
        positionEntity.getCurrency().setCurrencyKy("USD");
        final ResponseEntity<JsonNode> positionResponse = new ResponseEntity<>(node, HttpStatus.CREATED);

        var cancelContractUrl = TEST_ENDPOINT + TEST_API_VERSION + TEST_CONTRACT_CANCEL_ENDPOINT;
        var approveContractUrl = TEST_ENDPOINT + TEST_API_VERSION + TEST_CONTRACT_APPROVE_ENDPOINT;
        var contractUrl = TEST_ENDPOINT + TEST_API_VERSION + TEST_CONTRACT_ENDPOINT;
        final ResponseEntity<JsonNode> response = ResponseEntity.status(200).build();

        when(restTemplate.postForEntity(eq(getPositionUrl), any(), eq(JsonNode.class))).thenReturn(positionResponse);
        when(restTemplate.exchange(eq(cancelContractUrl), eq(POST), any(), eq(JsonNode.class), eq("testId"))).thenReturn(response);
        when(contractRepository.findAllByContractStatus(any())).thenReturn(List.of(contractEntity));

        eventService.cancelContract();

        verify(restTemplate).exchange(eq(cancelContractUrl), eq(POST), any(), eq(JsonNode.class), eq("testId"));
        verify(restTemplate, never()).exchange(eq(approveContractUrl), eq(POST), any(), eq(JsonNode.class), eq("testId"));
        verify(restTemplate, never()).exchange(eq(contractUrl), eq(PATCH), any(), eq(JsonNode.class), eq("testId"));
    }
}
