1. Insert the initial position to the database
    a) positionStatus should be 'PENDING ONESOURCE CONFIRMATION'
    b) processingStatus should be 'CREATED'

INSERT INTO account (id, account_id, short_name, lei, one_source_id, dtc)
VALUES (35, 35, 'lender_acc', '35', 35, 1),
       (46, 46, 'borrower_acc', '46', 46, 2);

INSERT INTO position (position_id, custom_value2, ticker, cusip, isin,
                      sedol, quick_code, price_factor, rate, end_date,
                      quantity, currency, tax_with_holding_rate, trade_date, term_id,
                      settle_date, deliver_free, amount, price, contract_value,
                      collateral_type, cp_haircut, cp_mark_round_to, depo_id, position_type,
                      account_id, cp_id, account_lei, cp_lei, processing_status, status,
                      index_id, index_name, spread, accrual_date, matching_1source_loan_contract_id)
VALUES ('35', '35', '35', '023135107', 'US0231351068',
        '2000010', '456', 0, 0.05, '2023-12-25 13:50:41.633000',
        11000.0, 'USD', 85.0, '2023-10-25 13:50:41.633000', 0,
        '2023-10-25 13:50:41.633000', false, 17935.5, 119.57, 17935.5,
        'CASH', 1.02, 0, 0, 'CASH LOAN',
        35, 46, '35', '46', 'CREATED', 'PENDING ONESOURCE CONFIRMATION',
        333, 'EFFR', 0.2, '2023-10-25 13:50:41.633000', 35);

2. Create a Trade response with a matched position for '/trades/search/onesource/trade/query'
    - the status should be 200
    - setup the TradeType as Rerate | Rerate Borrow | Roll Loan | Roll Borrow | Cancel Loan | Cancel Borrow

{
    "data": {
        "beans": [],
        "groups": [
            {
                "avg": {
                    "accrualDate": "2024-02-21T08:57:03.843Z",
                    "contractSettleDate": "2024-02-21T08:57:03.843Z",
                    "depoId": 0,
                    "endDate": "2024-02-21T08:57:03.843Z",
                    "lastModTs": "2024-02-21T08:57:03.843Z",
                    "positionId": 0,
                    "positionOutDTO": {
                        "__qualifiedName": "1",
                        "accountDTO": {
                            "__qualifiedName": "string",
                            "accountId": 35,
                            "dtc": 1,
                            "lei": "35",
                            "oneSourceId": 35,
                            "shortName": "lender_acc"
                        },
                        "accountId": 35,
                        "amount": 17935.5,
                        "collateralTypeDTO": {
                            "__qualifiedName": "string",
                            "categoryId": 0,
                            "collateralType": "CASH",
                            "collateralTypeId": 0,
                            "extCollateralType": "string",
                            "minRatingValue": 0,
                            "profileNo": "string",
                            "statusId": 0,
                            "tripartyAgentCode": "string"
                        },
                        "contractValue": 17935.5,
                        "counterPartyDTO": {
                            "__qualifiedName": "string",
                            "accountId": 46,
                            "dtc": 2,
                            "lei": "35",
                            "oneSourceId": 46,
                            "shortName": "borrower_acc"
                        },
                        "currencyDTO": {
                            "basisId": 0,
                            "bojCurrencyCode": 102,
                            "countryId": 0,
                            "currencyId": 51,
                            "currencyKy": "USD",
                            "currencyName": "US Dollar",
                            "currencySymbol": "$"
                        },
                        "customValue2": "35",
                        "depoId": 0,
                        "endDate": "2023-10-25T13:50:41.633Z",
                        "exposureDTO": {
                            "__qualifiedName": "string",
                            "accountId": 35,
                            "counterpartyId": 46,
                            "cpHaircut": 1.02,
                            "cpMarkRoundTo": 0,
                            "currencyId": 0,
                            "depoId": 0,
                            "exposureId": 1111,
                            "initMarkRoundTo": 0,
                            "positionTypeId": 50,
                            "xpHaircut": 0
                        },
                        "exposureId": 0,
                        "indexDTO": {
                            "__qualifiedName": "string",
                            "indexId": 0,
                            "indexName": "string",
                            "isActive": true,
                            "lookBack": 0,
                            "parentIndexId": 0,
                            "spread": 0
                        },
                        "indexId": 0,
                        "loanBorrowDTO": {
                            "__qualifiedName": "string",
                            "allInRate": 0,
                            "collateralCalendarId": 0,
                            "collateralIndexId": 0,
                            "collateralLookback": 0,
                            "collateralRate": 0,
                            "collateralSpread": 0,
                            "currentAllInRate": 0,
                            "currentTaxWithholdingRate": 0,
                            "dividend": 0,
                            "dividendCurrencyId": 0,
                            "endDate": "2023-10-25T13:50:41.633Z",
                            "positionId": 9999,
                            "startDate": "2023-10-25T13:50:41.633Z",
                            "taxWithholdingRate": 85
                        },
                        "positionId": 35,
                        "positionRef": "string",
                        "positionTypeId": 0,
                        "positiontypeDTO": {
                            "positionType": "CASH LOAN",
                            "positionTypeId": 0
                        },
                        "price": 119.57,
                        "quantity": 15000,
                        "rate": 0.05,
                        "securityDetailDTO": {
                            "__qualifiedName": "string",
                            "baseFeeRate": 0,
                            "bloombergId": "string",
                            "cusip": "023135106",
                            "factor": 0,
                            "fxRate": 0,
                            "isin": "US0231351067",
                            "issueDate": "2023-10-25T13:50:41.633Z",
                            "lastAccrualDate": "2023-10-25T13:50:41.633Z",
                            "lastModTs": "2023-10-25T13:50:41.633Z",
                            "price": 0,
                            "priceDTO": {
                                "__qualifiedName": "string",
                                "askPrice": 0,
                                "bidPrice": 0,
                                "cleanPrice": 0,
                                "comments": "string",
                                "defaultPrice": 0,
                                "dirtyPrice": 0,
                                "id": {
                                    "__qualifiedName": "string",
                                    "currencyId": 0,
                                    "priceDate": "2023-10-25T13:50:41.633Z",
                                    "refId": 0,
                                    "securityId": 0
                                },
                                "isDirty": 0,
                                "lastModTs": "2023-10-25T13:50:41.633Z",
                                "lastModUserId": 0,
                                "lastPrice": 0,
                                "price": 0
                            },
                            "priceFactor": 0,
                            "quickCode": "457",
                            "rate": 0,
                            "securityId": 314937,
                            "sedol": "2000019",
                            "spread": 0,
                            "ticker": "222"
                        },
                        "securityId": 0,
                        "seqNo": "string",
                        "settleDate": "2023-10-25T13:50:41.633Z",
                        "settledQuantity": 0,
                        "shellCusip": "string",
                        "spread": 0,
                        "statusDTO": {
                            "__qualifiedName": "string",
                            "status": "PENDING ONESOURCE CONFIRMATION",
                            "statusId": 0
                        },
                        "targetPrice": 0,
                        "termId": 0,
                        "tradeDate": "2023-10-25T13:50:41.633Z"
                    },
                    "postDate": "2024-02-21T08:57:03.844Z",
                    "price": 0,
                    "quantity": 15000,
                    "settleDate": "2024-02-21T08:57:03.845Z",
                    "tradeDate": "2024-02-21T08:57:03.845Z",
                    "tradeId": 0,
                    "tradeReasonId": 0,
                    "tradeTypeDetailDTO": {
                        "tradeType": "Cancel Borrow",
                        "tradeTypeId": 0
                    },
                    "tradeTypeId": 0
                }
            }
        ],
        "totalRows": 0
    },
    "errCode": "string",
    "error": true,
    "message": "string",
    "status": "ERROR",
    "success": true
}

3. Create a loan contract and required data that matches with the tested position

INSERT INTO internal_ref (id, broker, account_id, internal_id)
VALUES (35, 'testLenderBroker', '35', '35'),
       (46, 'testBorrowerBroker', '46', '46');

INSERT INTO party (id, party_id, party_name, gleif_lei, internal_id)
VALUES (35, 35, 'LENDER', '35', '35'),
       (46, 46, 'BORROWER', '46', '467');

INSERT INTO instrument (id, ticker, cusip, isin, sedol, quick_code)
VALUES  (35, '234', '023135106', 'US0231351067', '2000019', '457'),
        (46, '234', '023135106', 'US0231351067', '2000019', '457');

INSERT INTO fixed (id, base_rate, effective_rate, effective_date, cutoff_time)
VALUES (35, 0.05, 0, '2023-10-25 13:50:41.633000', '0'),
       (46, 0.05, 0, '2023-10-25 13:50:41.633000', '0');


INSERT INTO rebate (id, fixed)
VALUES (35, 35), (46, 46);

INSERT INTO rate (id, rebate)
VALUES  (35, 35), (46, 46);

INSERT INTO collateral (id, contract_price, contract_value, collateral_value, currency,
                        type, margin, rounding_rule, rounding_mode)
VALUES (35, 119.57, 17935.5, 17935.5, 'USD', 'CASH', 102.0, 0, 'ALWAYSUP'),
       (46, 119.57, 17935.5, 17935.5, 'USD', 'CASH', 102.0, 0, 'ALWAYSUP');

INSERT INTO venue (id, party_id, type, venue_name, venue_ref_key)
VALUES (35, '35', 'ONPLATFORM', 'testLenderVenueName', '35'),
       (46, '46', 'ONPLATFORM', 'testBorrowerVenueName', '46');


INSERT INTO trade (id, venue_id, instrument_id, rate_id, quantity, currency,
                   dividend_rate, trade_date, term_type, term_date, settlement_date,
                   settlement_type, collateral)
VALUES  (35, 35, 35, 35, 15000, 'USD',
        85.0, '2024-02-21 13:50:41.633000', 'OPEN', '2024-02-21 13:50:41.633000', '2023-10-25 13:50:41.633000',
        'DVP', 35),
        (46, 46, 46, 46, 15000, 'USD',
        85.0, '2024-02-21 13:50:41.633000', 'OPEN', '2024-02-21 13:50:41.633000', '2023-10-25 13:50:41.633000',
        'DVP', 46);

INSERT INTO agreement (id, agreement_id, status, trade_id, matching_spire_position_id, processing_status)
VALUES (35, '32b71278-9ad2-445a-bfb0-b5ada72f35', 'PENDING', 35, '35', 'CREATED'),
       (46, '32b71278-9ad2-445a-bfb0-b5ada72f46', 'PENDING', 46, '46', 'CREATED');

INSERT INTO transacting_party (id, party_role, party_id, internal_ref_id, transacting_party_id)
VALUES (35, 'LENDER', 35, 35, 35),
       (46, 'BORROWER', 46, 46, 46);

INSERT INTO contract (id, contract_id, contract_status, trade_id, processing_status,
                      matching_spire_position_id, matching_spire_trade_id)
VALUES (35, '35', 'PROPOSED', 35, 'UNMATCHED', 35, 35),
       (46, '46', 'PROPOSED', 46, 'UNMATCHED', 46, 46);

4. Check the required statuses for the required Trade Type flow